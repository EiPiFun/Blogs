# Reference: 
# https://wiki.debian.org/sbuild
# https://wiki.debian.org/Packaging/sbuild
# https://wiki.debian.org/zigo/mysbuild

# Install tools

sudo apt install sbuild devscripts git-buildpackage quilt piuparts openstack-pkg-tools

# Install apt-cacher-ng

sudo apt install apt-cacher-ng

sudo systemctl enable apt-cacher-ng
sudo systemctl restart apt-cacher-ng

# Create chroot for sbuild
# Change mirror if needed

# Remove old ones before creating
# sudo rm /etc/schroot/chroot.d/*

sudo mkdir -p /srv/sbuild/chroot/unstable-sbuild/

sudo sbuild-createchroot unstable /srv/sbuild/chroot/unstable-sbuild/ http://deb.debian.org/debian/

# Or include packages

sudo sbuild-createchroot --include=ca-certificates,lintian,piuparts unstable /srv/sbuild/chroot/unstable-sbuild/ http://deb.debian.org/debian/

# Set apt proxy

sudo vi /srv/sbuild/chroot/unstable-sbuild/etc/apt/apt.conf.d/99aptcacherng

```
Acquire::http::proxy "http://127.0.0.1:3142/";
Acquire::ftp::proxy "ftp://127.0.0.1:3142/";
```

# Upgrade

sudo chroot /srv/sbuild/chroot/unstable-sbuild/

apt update && apt upgrade -y

# Add user to group

sudo /usr/sbin/sbuild-adduser $(whoami)

# Configurations

vi ~/.gbp.conf

```
[DEFAULT]
builder = sbuild
ignore-branch = True
no-create-orig = True
[buildpackage]
export-dir = ../build-area/
```

#vi ~/.sbuildrc
mkdir -p ~/.config/sbuild/
vi ~/.config/sbuild/config.pl

```
$chroot_mode = "schroot";
$schroot = "schroot";
$clean_source = 0;
$build_source = 1;
$run_lintian = 1;
$run_piuparts = 1;
$run_autopkgtest = 1;
$autopkgtest_root_args = '';
$autopkgtest_opts = [ '--apt-upgrade', '--', 'unshare', '--release', '%r', '--arch', '%a' ];
$distribution = 'unstable';
$key_id = '0123456789ABCDEF';
```

vi ~/.profile

```
export DEBFULLNAME=*
export DEBEMAIL=*
```

# Build with extra repository

sbuild --extra-repository='deb http://deb.debian.org/debian experimental main'


